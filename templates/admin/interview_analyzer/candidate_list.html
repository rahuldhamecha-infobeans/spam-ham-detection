<link
  rel="stylesheet"
  href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
/>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
<table class="table table-responsive table-bordered" id="candidate_list">
  <thead>
    <th>Name</th>
    <th>Added By</th>
    <th>Report Generated</th>
    <th>Action</th>
  </thead>
  <tbody>
    {% if candidates %} {% for candidate in candidates %}

    <tr>
      <td>{{ candidate.name or 'N/A' }}</td>
      <td>{{ candidate.user_data().full_name or 'N/A' }}</td>
      <td>
        {% if candidate.is_report_generated %}
        <span class="badge generated">YES</span>
        {% else %}
        <span class="badge not_generated">NO</span>
        {% endif %}
      </td>
      <td>
        {% if candidate.is_report_generated %}
        <a
          target="_blank"
          href="/{{ candidate.interview_video  }}"
          class="btn btn-theme-white btn-sm"
          >View Video</a
        >
<!--         <a
          target="_blank"
          href="{{ candidate.report_url }}"
          class="btn btn-theme-white btn-sm"
          >Check Report</a
        > -->
        <a

          href="{{ url_for('interview_analyzer.view_report', id=candidate.id) }}"
          class="btn btn-theme-white btn-sm"
          >View Report</a

        >
         <a

          href="#"
          class="btn btn-theme-white btn-sm"
          data-toggle="modal"
          data-target="#deleteModal{{candidate.id}}"
      > Delete</a>

        <!-- The Modal -->
<div class="modal fade" id="deleteModal{{candidate.id}}" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteModalLabel">Confirm Delete</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this item?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <a href="{{ url_for('delete_route', item_id=candidate.id) }}" class="btn btn-danger">Delete</a>
            </div>
        </div>
    </div>
</div>
        {% else %} {% if candidate.video_analysis_status == "completed" %}
        <a
          href="{{ url_for('interview_analyzer.generate_report_command') }}?candidate={{ candidate.id }}"
          class="btn btn-theme-white btn-sm gr_loader"
          >Generate Report</a
        >
        {% endif %} {% endif %} {% if candidate.video_analysis_status ==
        "pending" %}
        <a
          href="#"
          data-candidate="{{ candidate.id }}"
          class="btn btn-theme-white btn-sm analyze-this"
          >Analyze Video</a
        >
        {% endif %} {% if candidate.video_analysis_status == "inprogress" %}
        Analyzing Please wait... for 15 -30 minutes {% endif %}
      </td>
    </tr>
    {% endfor %} {% else %}
    <tr>
      <td colspan="4">No Candidates Found.</td>
    </tr>
    {% endif %}
  </tbody>
</table>

<script>
    function reload_candidate_list_table() {
    $.ajax({
      type: "GET",
      url: '{{ url_for('interview_analyzer.fetch_candidate_list') }}',
      dataType: "html",
      success: function (response) {
        $(".table_div").html(response);
      },
    });
  }



  $(document).ready(function() {
  // Attach a click event handler to links with the 'analyze-this' class
      $('.analyze-this').click(function(event) {
          event.preventDefault(); // Prevent the default link behavior
          // Disable the link
          $(this).css({"pointer-events": "none", "opacity": "0.6"});
          $(this).text("Analyzing");
          // Get the candidate ID from the 'data-candidate' attribute
          var candidateId = $(this).data('candidate');
          // Perform your AJAX request here
          $.ajax({
          url: '{{ url_for('interview_analyzer.run_tasks') }}', // Replace with your actual AJAX endpoint URL
          type: 'POST', // or 'GET', depending on your requirements
          contentType: 'application/json', // Set the content type to JSON
          data: JSON.stringify({ candidate_id: candidateId }), // Convert data to JSON format
          success: function(response) {
              // Handle the AJAX response here
              console.log('AJAX success', response);
              reload_candidate_list();
              // You can update the UI or do other operations with the response data
          },
          error: function(xhr, status, error) {
              // Handle AJAX errors here
              console.error('AJAX error', status, error);
          }
          });

      });
  });
</script>

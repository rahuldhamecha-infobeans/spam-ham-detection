<link
  rel="stylesheet"
  href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
/>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
<table class="table table-responsive table-bordered" id="transcript_list">
  <thead>
    <th>Name</th>
    <th>Transcript File</th>
    <th>Added By</th>
    <th>Action</th>
  </thead>
  <tbody>

    {% if transcripts %} 
    {% for transcript in transcripts %}

    <tr>
      <td>{{ transcript.name or 'N/A' }}</td>
      <td>
        <a
          target="_blank"
          href="/{{ transcript.transcript  }}"
          class="btn btn-theme-white btn-sm"
          >View Transcipt</a
        >
      </td>
      <td>{{ transcript.user_data().full_name or 'N/A' }}</td>
      <td>
        {% if transcript.transcript_analysis_status == "completed" %}
        <a
          href="{{ url_for('interview_analyzer.view_transcript_report', id=transcript.id) }}"
          class="btn btn-theme-white btn-sm"
          >View Report</a
        >
        {% endif %}
        {% if transcript.transcript_analysis_status == "pending" %}
        <a
          href="#"
          data-transcript="{{ transcript.id }}"
          class="btn btn-theme-white btn-sm analyze-this-transcript"
          >Analyze Transcript</a
        >
        {% endif %}
      </td>
    </tr>
    {% endfor %} {% else %}
    <tr>
      <td colspan="4">No Candidates Found.</td>
    </tr>
    {% endif %}
  </tbody>
</table>


<script>

$(document).ready(function() {
// Attach a click event handler to links with the 'analyze-this' class
    $('.analyze-this-transcript').click(function(event) {
        event.preventDefault(); // Prevent the default link behavior
        // Disable the link
        $(this).css({"pointer-events": "none", "opacity": "0.6"});
        $(this).text("Analyzing");
        // Get the candidate ID from the 'data-candidate' attribute
        var transcriptId = $(this).data('transcript');
        // Perform your AJAX request here
        $.ajax({
        url: '{{ url_for('interview_analyzer.analyze_transcript') }}', // Replace with your actual AJAX endpoint URL
        type: 'POST', // or 'GET', depending on your requirements
        contentType: 'application/json', // Set the content type to JSON
        data: JSON.stringify({ transcript_id: transcriptId }), // Convert data to JSON format
        success: function(response) {
            // Handle the AJAX response here
            console.log('AJAX success sdsads', response);
            alert("Transcript Analysis Complete!")
            reload_transcript_list();
            // You can update the UI or do other operations with the response data
        },
        error: function(xhr, status, error) {
            // Handle AJAX errors here
            console.error('AJAX error', status, error);
        }
        });

    });
});
</script>